// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// @db.Date = '1958-02-07' instead '1958-02-07T11:22:49.727Z'
model Member {
  // Basic fields
  id          String   @id @default(uuid())
  birthday    DateTime @db.Date()
  email       String?  @db.VarChar(255)
  phoneNumber String
  fullName    String   @db.VarChar(255)
  sex         Sex

  // Gym-related fields
  status          Status    @default(enquiry)
  belt            BeltRank  @default(white)
  stripe          Int       @default(0)
  joinedDate      DateTime  @db.Date()
  contractEndDate DateTime? @db.Date()
  medicalIssues   String?
  homeAddress     String
  signedWaiver    Boolean   @default(false)
  notes           String?

  Attendance Attendance[]

  // @@unique([fullName, birthday])
}

model Class {
  id           String   @id @default(uuid())
  name         String
  description  String?
  startDate    DateTime @db.Date()
  dayOfWeek    Int // Easier searching classes based of DOW
  startTime    DateTime @db.Time()
  endTime      DateTime @db.Time()
  intervalDays Int

  Attendance Attendance[]
}

model Attendance {
  id        String   @id @default(uuid())
  classDate DateTime @db.Date()

  attendee   Member @relation(fields: [attendeeId], references: [id])
  attendeeId String
  class      Class  @relation(fields: [classId], references: [id])
  classId    String
  // class    Class[]
  // attendee Member[]

  @@unique([attendeeId, classId, classDate])
}

enum Sex {
  female
  male
}

enum Status {
  enquiry
  trial
  member
}

enum BeltRank {
  white
  blue
  purple
  brown
  black
}
